\documentclass[letterpaper]{article}

\pdfpagewidth=\paperwidth
\pdfpageheight=\paperheight

\usepackage{graphicx} %get graphics commands
\usepackage{times}

\usepackage{fullpage}

%get \FloatBarrier command
\usepackage{placeins} 

%give option to use commands like 0.5\textwidth for distances
\usepackage{calc} 
 %allows wraping figures around text
\usepackage{wrapfig}

%adds option to include verbatim input from files
\usepackage{moreverb} 

\title{Overview of Focal Adhesion Analysis Code Base}
\author{Matthew Berginski}

\begin{document}

\maketitle

\begin{abstract}
	The Focal Adhesion (FA) code base was designed to take a set of raw
	experimental images from an experiment where a given FA protein was tagged
	with a fluorescent marker and go through all the processing steps needed to
	determine a range of properties about the FA found by the system. This
	document is not meant to provide information about the biology of FAs, but
	instead to given you some orientation as to how to work with the system of
	scripts I've created to do the FA analysis. Hopefully after reading this
	document you will be able to wade into the code I've written and make
	headway in adding feature or adjusting settings.
\end{abstract}

\section{Introduction}
	The FA analysis code base is divided into a series of programs, which when run
	in the correct order, should find the FAs in a set of experiments, track their
	movement and output a set of data files describing various FA properties. The
	master control program is located in the
	\emph{src/scripts/build\_all\_results.pl} file (I'll use italics for all
	directories and files). This program lists the programs that are run to analyse
	each experiment and their order of execution. The programs can be divided into
	four sections:

		\begin{itemize}
		\item setup: very simple, consists of single script to move data into the
		proper location for follow-up steps
		\item finding cell features: this series of scripts locates the FA and
		extracts the properties needed to analyze the FA
		\item analyzing cell features: this series of scripts starts with tracking
		the adhesions and then moves into analyzing the results of the tracking
		algorithms
		\item visualization: this script builds a few visualizations of the results
		of tracking and other analysis results
		\end{itemize}

	Each of these areas will get a section detailing all the programs that are run
	for each section, but first some general code conventions.

\section{Coding Style/Conventions}
	There are several general motifs present in how the programs were written. You
	will find code written in three languages, matlab, perl and R. The matlab
	programs all work directly with the images. I decided to use matlab for the
	image processing due to the built-in matlab image processing toolkit. Perl is
	used in two ways: to build/execute the matlab commands needed to do the image
	processing and also to track the FA. I decided to use Perl for this because I'm
	most familiar with perl, but really any language with a decent interface to the
	operating system and text processing capabilities could be used in it's place.
	Finally, I used R for all the statistical processing. I decided to use R due to
	the well established set of tools provided for curve fitting and
	downstream data analysis.

	\subsection{Command Line Options}

	All of the programs are command line native, so if you aren't comfortable
	navigating the file system and running programs from the command line, I suggest
	you turn back find another tutorial on those topics. As command line programs,
	there are several command line switches that are present in all of the
	programs. Each program expects that you will provide it with a reference to a
	configuration file (see next paragraph for more about config files), as
	specified after the \emph{-cfg} switch. Since the programs were also developed
	with use on the UNC supercomputers, each program also has a \emph{-lsf} option,
	which shifts all the commands to send jobs off to the LSF computation job
	queuing system, instead of running the program immediately. I suggest you search
	help.unc.edu for "LSF", if you are unfamiliar with the system.

	\subsection{Config Files}

	Information and settings about each experiment are stored in a set of
	configuration files in the \emph{data} directory. All of the configs are in the
	Apache format and are processed by the "Config::General" cpan module, if you are
	unfamiliar with Apache config files, I suggest you read the config file format
	option of the module documentation. I have made a perl script that builds a few
	more FA specific definitions into the module, you can find that perl library at
	\emph{src/lib/Config/Adhesions.pm}. There are a hierarchy of config files that
	the programs use to determine the locations of important files and the settings
	to use for program execution. Generally, there are three config files used for
	each experiment: one in the same directory as the experimental data, another in
	the \emph{data/config} directory for the type of experiment and another default
	config at \emph{data/config/default.cfg} referenced by all the scripts.

	The config file in the directory for each experiment is normally very short,
	only containing the name of the experiment. I have settled on using
	"time\_series\_\#\#\#" for the names of most experiments. When you want to
	run a script on a given experiment, you will point the \emph{-cfg} parameter
	to this single experiment file. Next up on the config layer is the file for
	each type of experiment. Generally, I've split these experiment type config
	files up along perturbations applied to the system, such as the S178A
	mutation described in the first paper. In the experiment configs you will
	always find a reference the name of the experiment type. You will also find
	any tweaks there were needed to make that type of experiment work in the
	system, most often these fall into the area of changing thresholds needed to
	detect adhesions or settings related to the assembly/disassembly rate
	finding. The bottom level of the config files in the default config. Many
	(probably most) of the configuration options are described in the default
	config file, but you will see that several are commented out by default. The
	commented options are those that will often need to be specified in another
	higher level config file.  You can see examples of how several of these
	experiment config files are setup by looking in the projects folder of the
	Drobo disk array on heimdall (/Volumes/Drobo/projects/focal\_adhesions/). I
	suggest you start with the \emph{data/focal\_adhesions/} set of experiments.

\section{Setup}
	The experimental data coming into the system is expected to consist of a set
	of images showing the cell at each time point. The raw data straight from
	the microscope is stored in \emph{data}. To normalize how the rest of the
	scripts work with the raw data, the first step copies all the raw images
	into the \emph{results} directory into a folder for each experiment. I
	decided to have this extra copying step because the experimental data comes
	in several different formats, with the biggest distinction being
	whether the images are stacks or single images, and I wanted every program
	that interacts directly with the raw data to be able to look for a single
	file for each frame of the movie.

	The copying process is controlled by
	\emph{src/find\_cell\_features/setup\_results\_folder.pl}. All of the images
	copied during setup are written as 16-bit grayscale png's, which should
	preserve the full bit depth of any image I've seen coming off a microscope.
	Currently the system looks for two types of files, one containing a tagged
	adhesion protein and a myristolated-RFP, which is used to find the cell
	edge.

\section{Finding Cell Features}
	Two types of features are assessed by the system, the location of the cell
	bodies in the images and locations of the adhesions. The cell bodies are
	found using roughly the same method as one of Gaudenz papers\cite{Machacek06}.
	Briefly, a histogram of the intensity values in the image is gathered and a
	dip between the first to peaks is found. The first peek should encompass all
	the background pixels (low fluorescence values), while the second peek
	should encompass the cell. The low point between the two peaks is used as the
	threshold and after some clean up steps, the cell bodies are found. The perl
	script that controls sending off the cell finding matlab commands is
	\emph{src/find\_cell\_features/collect\_mask\_image\_set.pl}, while the
	matlab code used to analyze the images is
	\emph{src/find\_cell\_features/find\_cell\_mask.m}. The resulting cell mask
	binary images are written to each image folder to be used in downstream
	processing steps. The system is flexible enough that if the source image
	needed to find the cell mask isn't present, then the processing steps will
	continue, with the properties where the cell mask is needed (distance from edge,
	distance from center,...) won't be calculated.
	
	The adhesions are also found using a slightly modified method already
	present in the literature\cite{Zamir1999}. The method detailed in the paper
	is a constrained watershed algorithm, I've made a few modifications to fill
	in a few holes in the logic of the algorithm which are detailed in the paper
	and the code. The perl script that sends off the matlab jobs to find the
	adhesions is \emph{src/find\_cell\_features/collect\_fa\_image\_set.pl},
	while the matlab code is in
	\emph{src/find\_cell\_features/find\_focal\_adhesions.pl}.

	The last step in cell feature finding is to determine the properties of
	each adhesion. Most of the properties are calculated by the matlab function
	'regionprops'. 
	

\section{Analyzing Cell Features}

\section{Visualization}

\bibliography{all_literature}{}
\bibliographystyle{plain}
\end{document}
